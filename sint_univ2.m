function A=sint_univ2(A,B)
A1=A(:,:,1)>128;
A2=A(:,:,2)>128;
A3=A(:,:,3)>128;
A10=A1;
A20=A2;
A30=A3;
C1=round(real(ifft2(fft2(A10).*fft2(B))));
C2=round(real(ifft2(fft2(A20).*fft2(B))));
C3=round(real(ifft2(fft2(A30).*fft2(B))));
C=C1+C2+C3;

L=(1-(C<1.5));    %одиночки=0

A1=A1.*L;
A2=A2.*L;   %уничтожаем все одиночки
A3=A3.*L;

L=(1-(C>3.5));    %переселенцы=0

A1=A1.*L;
A2=A2.*L;   %уничтожаем все переселенцы
A3=A3.*L;

A1=A1+(C1>2.5).*(C1<3.5).*(C2<0.5).*(C3<0.5).*(A2<0.5).*(A3<0.5)+...
    (C1>1.5).*(C1<2.5).*(C2>0.5).*(C2<1.5).*(C3<0.5).*(A2<0.5).*(A3<0.5);

A2=A2+(C1<0.5).*(C2>2.5).*(C2<3.5).*(C3<0.5).*(A1<0.5).*(A3<0.5)+...
    (C1>0.5).*(C1<1.5).*(C2>1.5).*(C2<2.5).*(C3<0.5).*(A1<0.5).*(A3<0.5)+...
    (C1<0.5).*(C2>1.5).*(C2<2.5).*(C3>0.5).*(C3<1.5).*(A1<0.5).*(A3<0.5)+...
    (C1>1.5).*(C1<2.5).*(C2<0.5).*(C3>0.5).*(C3<1.5).*(A1<0.5).*(A3<0.5)+...
    (C1>0.5).*(C1<1.5).*(C2<0.5).*(C3>1.5).*(C3<2.5).*(A1<0.5).*(A3<0.5)+...
    (C1>0.5).*(C1<1.5).*(C2>0.5).*(C2<1.5).*(C3>0.5).*(C3<1.5).*(A1<0.5).*(A3<0.5);

A3=A3+(C1<0.5).*(C2<0.5).*(C3>2.5).*(C3<3.5).*(A1<0.5).*(A2<0.5)+...
    (C1<0.5).*(C2>0.5).*(C2<1.5).*(C3>1.5).*(C3<2.5).*(A1<0.5).*(A2<0.5);

A(:,:,1)=A1*255;
A(:,:,2)=A2*255;
A(:,:,3)=A3*255;